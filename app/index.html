<!DOCTYPE html>
<html>

<head>
	<title id="versionApp"></title>

	<link rel="stylesheet" type="text/css" href="assets/icoMoon/style.css">
	<link rel="stylesheet" type="text/css" href="assets/UnoStock-v1.0/style.css">
	<link rel="stylesheet" type="text/css" href="assets/style/index.css">
	<link rel="stylesheet" type="text/css" href="assets/style/Dashboard.css">
	<link rel="stylesheet" type="text/css" href="assets/style/Movimientos.css">
	<!---<link rel="stylesheet" type="text/css" href="assets/style/Proveedores.css">-->
	<link rel="stylesheet" type="text/css" href="assets/style/Productos.css">

</head>

<body id="app">
	<aside class="container-Aside aside_menu">
		<img class="aside_menu_img_app" src="assets/image/example.png">
		<div class="sub_aside_menu1">
			<button class="btn_aside_menu" onclick="SelectMenu('Dashboard')"><span
					class=" iconUnoStock-dashboard"></span>Dashboard</button>
			<button class="btn_aside_menu" onclick="SelectMenu('Productos')"><span
					class="iconUnoStock-Productos"></span>Productos</button>
			<button class="btn_aside_menu" onclick="SelectMenu('Proveedores')"><span
					class="iconUnoStock-Proveedores"></span>Proveedores</button>
			<button class="btn_aside_menu" onclick="SelectMenu('Movimientos')"><span
					class="iconUnoStock-Movimientos"></span>Movimientos</button>
		</div>
		<div class="sub_aside_menu2">
			<button class="btn_aside_menu"><span class=" iconUnoStock-settings"></span>Configuración</button>
		</div>
	</aside>
	<header class="containner-header header_app">
		<div class="containner-info-header">
			<h1 class="title-header" id="title_header">Dashboard</h1>
			<p class="sub-title-header" id="sub_title_header">#########</p>
		</div>

		<h1 class="Information-cambio-moneda" id="data-cambio-actual-dasboard"> </h1>

		<div class="sub-containner-icono-header">
			<h2 class="Text-icono">UnoStock</h2>
			<label class="iconoApp iconUnoStock-Logo"></label>
		</div>
	</header>
	<main class="container-main" id="main_containner_activity">
	</main>
</body>
<script type="text/javascript" src="assets/icoMoon/selection.json"></script>
<script type="text/javascript" src="assets/UnoStock-v1.0/selection.json"></script>
<script type="text/javascript" src="assets/js/AudioSpeak.js"></script>
<script type="text/javascript" src="assets/js/chartjs.js"></script>
<script type="text/javascript" src="assets/js/Main.js"></script>
<script type="text/javascript" src="assets/js/TimeSystem.js"></script>
<script type="text/javascript" src="Dashboard/Dashboard.js"></script>
<script type="text/javascript" src="Proveedores/Proveedores.js"></script>
<script type="text/javascript" src="Movimientos/Movimientos.js"></script>
<script type="text/javascript" src="Productos/Productos.js"></script>

<script type="text/javascript">

	Speak("Bienvenido")
	api.send("app_version");
	api.receive('app_version', (event, info) => {

		document.getElementById("versionApp").innerHTML = info.name + " " + info.version;

	})
	Dashboard("main_containner_activity");
	document.getElementById("title_header").innerHTML = "Dashboard";
	document.getElementById("sub_title_header").innerHTML = "Menu principal informativo";

	function SelectMenu(OPT) {
		if (OPT == "Dashboard") {
			Dashboard("main_containner_activity");
			document.getElementById("title_header").innerHTML = "Dashboard";
			document.getElementById("sub_title_header").innerHTML = "Menu principal informativo";
		}
		if (OPT == "Productos") {
			Productos("main_containner_activity");
			document.getElementById("title_header").innerHTML = "Productos";
			document.getElementById("sub_title_header").innerHTML = "Información de productos";
		}
		if (OPT == "Proveedores") {
			Proveedores("main_containner_activity");
			document.getElementById("title_header").innerHTML = "Proveedores";
			document.getElementById("sub_title_header").innerHTML = "Información de Proveedores";
		}
		if (OPT == "Movimientos") {
			Movimientos("main_containner_activity");
			document.getElementById("title_header").innerHTML = "Movimientos";
			document.getElementById("sub_title_header").innerHTML = "Ultimos Movimientos";
		}
	}

/*-----------------------------------------------------------------------*/

/*-----------------------------------------------------------------------*/
// Función para obtener el valor de 1 USD en bolívares
async function obtenerCambioUSD() {
  try {
    const respuesta = await fetch("https://ve.dolarapi.com/v1/dolares/oficial");
    const datos = await respuesta.json();

    console.log(datos)

        return datos.promedio;

  } catch (error) {
    console.error("Error al obtener el cambio:", error);
    return null;
  }
}

// Uso de la función
obtenerCambioUSD().then(valor => {
  document.getElementById("data-cambio-actual-dasboard").innerHTML=`1 USD = ${valor} Bs`
});


function programarFuncionDiaria(funcionAEjecutar, horas) {
    const ahora = new Date();
    const hoy = ahora.getDate();
    const esteMes = ahora.getMonth();
    const esteAnio = ahora.getFullYear();
    const tiempoActualMs = ahora.getTime();

    // 1. Encontrar el próximo momento de ejecución
    let proximaEjecucionMs = Infinity;

    // Buscar la hora de hoy más cercana en el futuro
    for (const hora of horas) {
        // Creamos un objeto Date para la hora programada de hoy
        const tiempoProgramado = new Date(esteAnio, esteMes, hoy, hora, 0, 0, 0);
        const tiempoProgramadoMs = tiempoProgramado.getTime();

        if (tiempoProgramadoMs > tiempoActualMs) {
            // Es una hora en el futuro hoy
            proximaEjecucionMs = Math.min(proximaEjecucionMs, tiempoProgramadoMs);
        }
    }

    // 2. Si no hay más horas hoy, programar para la primera hora de mañana
    if (proximaEjecucionMs === Infinity) {
        // Ordenamos las horas para encontrar la primera hora de mañana
        horas.sort((a, b) => a - b);
        const primeraHoraManana = horas[0];
        const manana = new Date(esteAnio, esteMes, hoy + 1, primeraHoraManana, 0, 0, 0);
        proximaEjecucionMs = manana.getTime();
    }


    const retrasoMs = proximaEjecucionMs - tiempoActualMs;

    setTimeout(() => {

        funcionAEjecutar();

        programarFuncionDiaria(funcionAEjecutar, horas);
    }, retrasoMs);
}

const miFuncion = () => {

    // Uso de la función
    obtenerCambioUSD().then(valor => {
      document.getElementById("data-cambio-actual-dasboard").innerHTML=`1 USD = ${valor} Bs`
    });

};

programarFuncionDiaria(miFuncion, [15, 17]);
</script>

</html>